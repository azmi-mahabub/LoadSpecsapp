{% extends 'LoadSpecsHTML/base.html' %}

{% block title %}Team - LoadSpecs{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="display-4">Team Management</h1>
        </div>
    </div>
    
    {% if is_team_lead %}
    <!-- Team Lead View -->
    <div class="row mb-3">
        <div class="col-12">
            <a href="{% url 'create_team' %}" class="btn btn-primary-custom">
                <i class="fas fa-plus"></i> Create New Team
            </a>
        </div>
    </div>
    
    {% if teams %}
    <div class="row">
        {% for team in teams %}
        <div class="col-md-6 col-lg-4 mb-4">
            <div class="card-custom">
                <h3>{{ team.team_name }}</h3>
                <p class="text-muted">{{ team.description|default:"No description" }}</p>
                
                <div class="mt-3">
                    <h5>Team Members</h5>
                    {% if team.employees.all %}
                    <ul class="list-group">
                        {% for employee in team.employees.all %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <i class="fas fa-user"></i> {{ employee.user.username }}
                                <br>
                                <small class="text-muted">{{ employee.user.email }}</small>
                            </div>
                            <span class="badge bg-secondary">
                                {{ employee.assigned_tasks }} tasks
                            </span>
                        </li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    <p class="text-muted">No members yet</p>
                    {% endif %}
                </div>
                
                <div class="mt-3">
                    <div class="alert alert-info">
                        <strong>Join Code:</strong> <code>{{ team.join_code }}</code>
                        <br>
                        <small>Share this code with employees to join your team</small>
                    </div>
                </div>
                
                <div class="mt-3">
                    <p><strong>Created:</strong> {{ team.created_at|date:"M d, Y" }}</p>
                    <p><strong>Total Tasks:</strong> {{ team.total_tasks }}</p>
                    <p><strong>Progress:</strong></p>
                    <div class="progress-bar-custom">
                        <div class="progress-fill" style="width: {{ team.progress_percentage }}%"></div>
                    </div>
                    <small>{{ team.progress_percentage }}% complete</small>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="alert alert-info">
        <i class="fas fa-info-circle"></i> You haven't created any teams yet. Click "Create New Team" to get started!
    </div>
    {% endif %}
    
    {% elif is_employee %}
    <!-- Employee View -->
    {% if team %}
    <div class="row">
        <div class="col-12 mb-4">
            <div class="card-custom">
                <h2>{{ team.team_name }}</h2>
                <p class="lead">{{ team.description|default:"No description" }}</p>
                
                <div class="mt-3">
                    <p><strong>Team Lead:</strong> {{ team.created_by.username }}</p>
                    <p><strong>Members:</strong> {{ team.member_count }}</p>
                    <p><strong>Total Tasks:</strong> {{ team.total_tasks }}</p>
                </div>
                
                <div class="mt-3">
                    <h5>Team Progress</h5>
                    <div class="progress-bar-custom">
                        <div class="progress-fill" style="width: {{ team.progress_percentage }}%"></div>
                    </div>
                    <small>{{ team.progress_percentage }}% complete</small>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col-12">
            <h3>Team Members</h3>
            <div class="card-custom">
                {% if team_members %}
                <div class="row">
                    {% for member in team_members %}
                    <div class="col-md-6 col-lg-4 mb-3">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body text-center">
                                {% if member.user.profile_picture %}
                                <img src="{{ member.user.profile_picture.url }}" alt="{{ member.user.username }}" 
                                     class="rounded-circle mb-3" style="width: 80px; height: 80px; object-fit: cover;">
                                {% else %}
                                <i class="fas fa-user-circle fa-4x mb-3 text-secondary"></i>
                                {% endif %}
                                <h5>{{ member.user.username }}</h5>
                                <p class="text-muted">{{ member.user.email }}</p>
                                <div class="mt-2">
                                    <small>
                                        <span class="badge bg-primary">{{ member.assigned_tasks }} tasks</span>
                                        <span class="badge bg-success">{{ member.completed_tasks }} completed</span>
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-muted">No other team members yet.</p>
                {% endif %}
            </div>
        </div>
    </div>
    
    {% else %}
    <div class="alert alert-warning">
        <i class="fas fa-exclamation-triangle"></i> You're not part of any team yet.
    </div>
    <div class="card-custom">
        <h3>Join a Team</h3>
        <p>Ask your team lead for a join code to become part of a team.</p>
        <a href="{% url 'join_team' %}" class="btn btn-primary-custom">
            <i class="fas fa-sign-in-alt"></i> Join Team
        </a>
    </div>
    {% endif %}
    
    {% endif %}
</div>
{% endblock %}
